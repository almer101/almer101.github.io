
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Numerical procedures to solve Partial Differential Equations (PDE) &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"tex": {"macros": {"N": "\\mathbb{N}", "floor": ["\\lfloor#1\\rfloor", 1], "bmat": ["\\left[\\begin{array}"], "emat": ["\\end{array}\\right]"], "expec": ["\\mathbb{E}\\left[#1\\right]", 1], "expecc": ["\\mathbb{E}^\\mathbb{#1}\\left[#2\\right]", 2]}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'stochastic_processes/pde_numerical';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Yield Curve, Zero Rates, and Term Structure" href="../fixed_income/yc_and_ts.html" />
    <link rel="prev" title="Bond prices under the Ornstein Uhlenbeck mean-reverting process" href="ou_mean_reverting_bond_price.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="My sample book - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="My sample book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    About the Author and Content
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Probability</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../probability/probability_basics.html">Discrete Probability Basics</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Stochastic Processes</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="brownian_motion.html">Brownian Motion</a></li>
<li class="toctree-l1"><a class="reference internal" href="ou_mean_reverting_bond_price.html">Bond prices under the Ornstein Uhlenbeck mean-reverting process</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Numerical procedures to solve Partial Differential Equations (PDE)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Fixed Income</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../fixed_income/yc_and_ts.html">Yield Curve, Zero Rates, and Term Structure</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fstochastic_processes/pde_numerical.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/stochastic_processes/pde_numerical.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Numerical procedures to solve Partial Differential Equations (PDE)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-generic-price-process-s-t">A generic price process <span class="math notranslate nohighlight">\(S_t\)</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#black-scholes-pde">Black Scholes PDE</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#proof">Proof</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#choosing-the-payoff-to-price">Choosing the payoff to price</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#constructing-the-grid">Constructing the grid</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#choosing-the-process-governing-the-underlying-s">Choosing the process governing the underlying <span class="math notranslate nohighlight">\(S\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#partial-derivatives-estimation">Partial derivatives estimation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#constructing-the-system-of-equations">Constructing the system of equations</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#single-node-equation">Single node equation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#equation-for-the-whole-row">Equation for the whole row</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#results">Results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="numerical-procedures-to-solve-partial-differential-equations-pde">
<h1>Numerical procedures to solve Partial Differential Equations (PDE)<a class="headerlink" href="#numerical-procedures-to-solve-partial-differential-equations-pde" title="Link to this heading">#</a></h1>
<p><em>Date Posted: 27 March 2024</em></p>
<section id="a-generic-price-process-s-t">
<h2>A generic price process <span class="math notranslate nohighlight">\(S_t\)</span><a class="headerlink" href="#a-generic-price-process-s-t" title="Link to this heading">#</a></h2>
<p>Let us say that a general price process can be described as:</p>
<div class="math notranslate nohighlight">
\[dS = a(t,S_t)dt + b(t,S_t)dW_t^\mathbb{Q}\]</div>
<p>where <span class="math notranslate nohighlight">\(W^\mathbb{Q}\)</span> is a Brownian motion under the risk neutral probability measure <span class="math notranslate nohighlight">\(\mathbb{Q}\)</span>.</p>
</section>
<section id="black-scholes-pde">
<h2>Black Scholes PDE<a class="headerlink" href="#black-scholes-pde" title="Link to this heading">#</a></h2>
<p>Probably the most famous PDE in finance is the Black Scholes PDE, which descibes the dynamic relationship that the price of a derivative (<span class="math notranslate nohighlight">\(F\)</span>) needs to satisfy in order for the price to be risk neutral. The equation is expressed as:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial F}{\partial t} + \frac{\partial F}{\partial S} a(t,S_t) + \frac{1}{2}\frac{\partial^2 F}{\partial S^2} b^2(t,S_t) = rF\]</div>
<section id="proof">
<h3>Proof<a class="headerlink" href="#proof" title="Link to this heading">#</a></h3>
<p>The main idea behind the proof is that the <strong>discounted price process of our derivative</strong> <span class="math notranslate nohighlight">\(\left(\tilde{F}(t,S_t) = e^{-rt}F(t,S_t)\right)\)</span> needs to be a martingale under the risk neutral probability measure <span class="math notranslate nohighlight">\(\mathbb{Q}\)</span>. If that is the case, that means that (under <span class="math notranslate nohighlight">\(\mathbb{Q}\)</span>) the drift of the process needs to be zero.</p>
<p>First we need to express the differential of <span class="math notranslate nohighlight">\(\tilde{F}\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{split}
    d\left(e^{-rt}F\right) &amp;= -re^{-rt}F dt + e^{-rt} dF \\
    &amp;= -re^{-rt}F dt + e^{-rt} \left( \frac{\partial F}{\partial t}dt + \frac{\partial F}{\partial S}dS + \frac{1}{2}\frac{\partial^2 F}{\partial S^2}d\left\langle S,S\right\rangle _t \right) \\
    &amp;= -re^{-rt}F dt + e^{-rt} \left( \frac{\partial F}{\partial t}dt + \frac{\partial F}{\partial S}\left( a(t,S_t)dt + b(t,S_t)dW_t^\mathbb{Q} \right) + \frac{1}{2}\frac{\partial^2 F}{\partial S^2}b^2(t,S_t)dt \right) \\
    &amp;= e^{-rt}\left( -rF + \frac{\partial F}{\partial t} + \frac{\partial F}{\partial S}a(t,S_t) + \frac{1}{2}\frac{\partial^2 F}{\partial S^2}b^2(t,S_t) \right)dt + (\cdots)dW_t^\mathbb{Q}
\end{split}
\end{split}\]</div>
<p>Here the drift part needs to be zero:</p>
<div class="math notranslate nohighlight">
\[-rF + \frac{\partial F}{\partial t} + \frac{\partial F}{\partial S}a(t,S_t) + \frac{1}{2}\frac{\partial^2 F}{\partial S^2}b^2(t,S_t) = 0\]</div>
<p>which gives us the BS PDE from above.</p>
</section>
</section>
<section id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Link to this heading">#</a></h2>
<section id="choosing-the-payoff-to-price">
<h3>Choosing the payoff to price<a class="headerlink" href="#choosing-the-payoff-to-price" title="Link to this heading">#</a></h3>
<p>For this exercise we chose the condor strategy that is a combination of <strong>four call options</strong> with the same maturity and with strike prices <span class="math notranslate nohighlight">\(K_1&lt;K_2&lt;K_3&lt;K_4\)</span>:</p>
<ul class="simple">
<li><p><strong>Long</strong> call with strike <span class="math notranslate nohighlight">\(K_1\)</span></p></li>
<li><p><strong>Short</strong> call with strike <span class="math notranslate nohighlight">\(K_2\)</span></p></li>
<li><p><strong>Short</strong> call with strike <span class="math notranslate nohighlight">\(K_3\)</span></p></li>
<li><p><strong>Long</strong> call with strike <span class="math notranslate nohighlight">\(K_4\)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">mcolors</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cbook</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;bmh&#39;</span><span class="p">)</span>

<span class="c1"># Payoff at maturity of the condor strategy</span>
<span class="k">def</span> <span class="nf">condor_payoff</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">k3</span><span class="p">,</span> <span class="n">k4</span><span class="p">):</span>
    <span class="n">payoff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">-</span><span class="n">k1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="o">-</span><span class="n">k2</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">s</span><span class="o">-</span><span class="n">k3</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">s</span><span class="o">-</span><span class="n">k4</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">payoff</span>

<span class="c1"># Strike prices</span>
<span class="n">k1</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">k2</span> <span class="o">=</span> <span class="mi">60</span>
<span class="n">k3</span> <span class="o">=</span> <span class="mi">140</span>
<span class="n">k4</span> <span class="o">=</span> <span class="mi">150</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">301</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">condor_payoff</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">k3</span><span class="p">,</span> <span class="n">k4</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Condor payoff&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Spot price at maturity ($S_T$)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Payoff amount&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/dd2ae43136e0b9da3d23f99f8efe05df0ad0604de2596caaa175c7b477f7911d.png" src="../_images/dd2ae43136e0b9da3d23f99f8efe05df0ad0604de2596caaa175c7b477f7911d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">S0</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">S_max</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">S0</span>

<span class="n">nt</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">ns</span> <span class="o">=</span> <span class="mi">100</span>

<span class="n">dt</span> <span class="o">=</span> <span class="n">T</span><span class="o">/</span><span class="n">nt</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">S_max</span><span class="o">/</span><span class="n">ns</span>

<span class="n">grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">nt</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">ns</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># left boundary</span>
<span class="n">grid</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># right boundary</span>
<span class="n">grid</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># bottom boundary</span>
<span class="n">S_T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ns</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">S_max</span> <span class="o">/</span> <span class="n">ns</span><span class="p">)</span>
<span class="n">grid</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">condor_payoff</span><span class="p">(</span><span class="n">S_T</span><span class="p">,</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k2</span><span class="p">,</span> <span class="n">k3</span><span class="p">,</span> <span class="n">k4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="constructing-the-grid">
<h3>Constructing the grid<a class="headerlink" href="#constructing-the-grid" title="Link to this heading">#</a></h3>
<p>When working with PDEs we need to work on a grid of possible values of <span class="math notranslate nohighlight">\(t\)</span> and <span class="math notranslate nohighlight">\(S\)</span> (see picture below). When we need to implement that in Python, the easiest way to represent it is by using a matrix. The values of time <span class="math notranslate nohighlight">\(t\)</span> will be in the interval <span class="math notranslate nohighlight">\(t\in[0,T]\)</span>, where <span class="math notranslate nohighlight">\(T\)</span> is the time of maturity of the contract, and the values of the underlying <span class="math notranslate nohighlight">\(S\)</span> will be in the in the interval <span class="math notranslate nohighlight">\([0,S_{max}]\)</span>, where we are free to choose <span class="math notranslate nohighlight">\(S_{max}\)</span>, but normally it is sufficient to choose <span class="math notranslate nohighlight">\(S_{max} = S_0\)</span>, where <span class="math notranslate nohighlight">\(S_0\)</span> is the current price of the underlying.</p>
<p>Other things that we need to choose are the number of steps that we are going to divide each dimension by:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(n_t\)</span> the number of steps for time</p></li>
<li><p><span class="math notranslate nohighlight">\(n_S\)</span> the number of steps for the underlying</p></li>
</ul>
<p>when we decide that, we know the size of each step for time and for the underlying, i.e.:</p>
<div class="math notranslate nohighlight">
\[\Delta t = \frac{T}{n_t} \hspace{0.2cm}\text{ and } \hspace{0.2cm}\Delta S = \frac{S_{max}}{n_S}\]</div>
<p>Then each possible value of time on our grid is represented by <span class="math notranslate nohighlight">\(t_i = i\Delta t\)</span>, where <span class="math notranslate nohighlight">\(i=0,...,n_t\)</span>. Analogously, for the underlying we have <span class="math notranslate nohighlight">\(S_j = j\Delta S\)</span>, where <span class="math notranslate nohighlight">\(j=0,...,n_S\)</span>.</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/4f45281d20e593ba4f156f2f7f830b04230bf1eb9cec92915e09f05127db62df.png" src="../_images/4f45281d20e593ba4f156f2f7f830b04230bf1eb9cec92915e09f05127db62df.png" />
</div>
</div>
</section>
<section id="choosing-the-process-governing-the-underlying-s">
<h3>Choosing the process governing the underlying <span class="math notranslate nohighlight">\(S\)</span><a class="headerlink" href="#choosing-the-process-governing-the-underlying-s" title="Link to this heading">#</a></h3>
<p>Now we have to assume a certain process of the underlying stock price. For simplicity and to be able to copmare the result with the one obtained by the closed-form Black-Scholes formula, here we choose the <strong>geometric Brownian motion</strong>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Keep in mind that the solution provided below works for any process as long as it is represetable as:</p>
<div class="math notranslate nohighlight">
\[dS = a(t,S_t)dt + b(t,S_t)dW_t^\mathbb{Q}\]</div>
</div>
<p>The GBM under the risk-neutral measure <span class="math notranslate nohighlight">\(\mathbb{Q}\)</span> is given by:</p>
<div class="math notranslate nohighlight">
\[dS = S(r-q) dt + S\sigma dW_t^\mathbb{Q}\]</div>
<p>So we can simply read the functions <span class="math notranslate nohighlight">\(a(t,S_t)\)</span> and <span class="math notranslate nohighlight">\(b(t,S_t)\)</span>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{split}
    a(t,S_t) &amp;= S(r-q) \\
    b(t,S_t) &amp;= S\sigma
\end{split}
\end{split}\]</div>
<p>Or in terms of our discrete grid:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{split}
    a(t,S_t) &amp;= \left(j\cdot \Delta S\right) (r-q) \\
    b(t,S_t) &amp;= \left(j\cdot \Delta S\right)\sigma
\end{split}
\end{split}\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="mf">0.04</span>
<span class="n">q</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.35</span>

<span class="k">def</span> <span class="nf">a</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">s</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="n">q</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">b</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">s</span><span class="o">*</span><span class="n">sigma</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="partial-derivatives-estimation">
<h3>Partial derivatives estimation<a class="headerlink" href="#partial-derivatives-estimation" title="Link to this heading">#</a></h3>
<p>Each point at the grid is <span class="math notranslate nohighlight">\(F(t,S)\)</span>, but <span class="math notranslate nohighlight">\(t\)</span> and <span class="math notranslate nohighlight">\(S\)</span> are the multiples of <span class="math notranslate nohighlight">\(\Delta t\)</span> and <span class="math notranslate nohighlight">\(\Delta S\)</span> that we choose when discretizing the grid:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{split}
    t_i = i\cdot\Delta t \\
    S_j = j\cdot\Delta S
\end{split}
\end{split}\]</div>
<p>This means that we can write <span class="math notranslate nohighlight">\(F(t_i,S_j)\)</span> as $<span class="math notranslate nohighlight">\(F(t_i,S_j) = F(i\Delta t, j\Delta S) \equiv f_{i,j}\)</span>$</p>
<p>where we choose to denote it with <span class="math notranslate nohighlight">\(f_{i,j}\)</span> for convenience.</p>
<p>We know that any derivative, which has <span class="math notranslate nohighlight">\(S_t\)</span> as an underlying, has to satisfy the differential equation from above, i.e.</p>
<div class="math notranslate nohighlight">
\[\frac{\partial F}{\partial t} + \frac{\partial F}{\partial S}a(t,S_t) + \frac{1}{2}\frac{\partial^2 F}{\partial S^2}b^2(t,S_t) = rF\]</div>
<p>We discretized the domain of <span class="math notranslate nohighlight">\((t,S)\)</span> with a grid and now the first question may be how will we use that to solve the PDE. Well we need to define how we will proxy the partial derivatives from the equation. When it comes to partial derivative w.r.t. <span class="math notranslate nohighlight">\(S\)</span>, we will use the <strong>central difference estimate</strong>. That is, if we want to evaulate these partial derivatives in the node <span class="math notranslate nohighlight">\(F(t_i,S_j)\)</span> , then we will use:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{split}
    \frac{\partial F}{\partial S} &amp;\approx \frac{F(t_i,S_j+\Delta S) - F(t_i,S_j-\Delta S)}{2\Delta S} = \frac{F(t_i,(j+1)\Delta S) - F(t_i,(j-1)\Delta S)}{2\Delta S} = \frac{f_{i,j+1} - f_{i,j-1}}{2\Delta S} \\
    \frac{\partial^2 F}{\partial S^2} &amp;\approx \frac{F(t_i,S_j+\Delta S) - 2F(t_i,S_j) + F(t_i,S_j-\Delta S)}{} =\frac{f_{i,j+1} - 2f_{i,j} + f_{i,j-1}}{2\Delta S}
\end{split}
\end{split}\]</div>
<p>The choice of our estimator for <span class="math notranslate nohighlight">\(\frac{\partial F}{\partial t}\)</span> will be crucial when it comes to stability of the solution. We have two choices:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{split}
    \frac{\partial F}{\partial t} \approx \frac{F(t_i,S_j) - F(t_i-\Delta t, S_j)}{\Delta t} = \frac{f_{i,j} - f_{i-1,j}}{\Delta t} \hspace{0.5cm} \text{(backward difference estimator)}\\
    \frac{\partial F}{\partial t} \approx \frac{F(t_i+\Delta t,S_j) - F(t_i, S_j)}{\Delta t} = \frac{f_{i+1,j} - f_{i,j}}{\Delta t} \hspace{0.5cm} \text{(forward difference estimator)}\\
\end{split}
\end{split}\]</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Notice that that these are forward/backward/central estimators <strong>with respect to the node</strong> <span class="math notranslate nohighlight">\(f_{i,j}\)</span></p>
</div>
<p>By choosing the <strong>backward difference estimator</strong> we will have a simpler solution, because three bottom nodes determine the value of one node above:</p>
<p><img alt="explicit" src="../_images/explicit.svg" /></p>
<p>The downside of this method is that it is not stable, and increasing number of steps <span class="math notranslate nohighlight">\(n_t\)</span> of <span class="math notranslate nohighlight">\(n_S\)</span> (i.e. decreasing the <span class="math notranslate nohighlight">\(\Delta t\)</span> and <span class="math notranslate nohighlight">\(\Delta S\)</span>) the numbers could <em>explode</em> and we would not get the correct solution.</p>
<p>However, if we choose the <strong>forward difference estimator</strong>, the solution requires us to solve the whole row at once and it is slightly more demanding to derive the system of equations, but it is a very stable solution and it does not suffer from the same problem as above. The reason why it is more challenging is because one node from below determines the value of three nodes above:</p>
<p><img alt="implicit" src="../_images/implicit.svg" /></p>
<p>We will go in the course of the latter, we will work out the math, even though it is a bit more challenging, but that will allow us to have a stable solution 🙃</p>
</section>
<section id="constructing-the-system-of-equations">
<h3>Constructing the system of equations<a class="headerlink" href="#constructing-the-system-of-equations" title="Link to this heading">#</a></h3>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/af8fc648de21f10af7a1f8ab9742e97c0d47b4af81a1be1a43ded8a456614638.png" src="../_images/af8fc648de21f10af7a1f8ab9742e97c0d47b4af81a1be1a43ded8a456614638.png" />
</div>
</div>
<section id="single-node-equation">
<h4>Single node equation<a class="headerlink" href="#single-node-equation" title="Link to this heading">#</a></h4>
<p>The PDE from above has to hold across the whole grid of course:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial F}{\partial t} + \frac{\partial F}{\partial S}a(t,S_t) + \frac{1}{2}\frac{\partial^2 F}{\partial S^2}b^2(t,S_t) = rF\]</div>
<p>To write it in terms of purple arrows or orange arrows we need to know which node we are at at the moment. Since the green nodes are boundary conditions and they are known, we loop over the first rown from below that is still unknown. So we start with the node <span class="math notranslate nohighlight">\(f_{0,1}\)</span>, then <span class="math notranslate nohighlight">\(f_{0,2}\)</span> etc.</p>
<p>When we talk about the <strong>purple</strong> arrows, the node that we are at is the node <span class="math notranslate nohighlight">\(f_{0,1}\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{gathered}
\frac{f_{1,1}-f_{0,1}}{\Delta t} + \frac{f_{0,2}-f_{0,0}}{2\Delta S}a(0\cdot \Delta t,1\cdot\Delta S) + \frac{1}{2}\frac{f_{0,2}-2f_{0,1}+f_{0,0}}{\left( \Delta S \right)^2}b^2(0\cdot \Delta t,1\cdot\Delta S) = rf_{0,1} \\
\frac{f_{1,1}-f_{0,1}}{\Delta t} + \frac{f_{0,2}-f_{0,0}}{2\Delta S}a_{0,1} + \frac{1}{2}\frac{f_{0,2}-2f_{0,1}+f_{0,0}}{\left( \Delta S \right)^2}b^2_{0,1} = rf_{0,1} \\
\end{gathered}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(a_{i,j} = a(i\cdot \Delta t, j\cdot \Delta S)\)</span> and <span class="math notranslate nohighlight">\(b_{i,j} = b(i\cdot \Delta t, j\cdot \Delta S)\)</span>.</p>
<p>When we want to write an equation for the <strong>orange</strong> arrows, our main node is <span class="math notranslate nohighlight">\(f_{0,2}\)</span> and we have:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{gathered}
\frac{f_{1,2}-f_{0,2}}{\Delta t} + \frac{f_{0,3}-f_{0,1}}{2\Delta S}a_{0,2} + \frac{1}{2}\frac{f_{0,3}-2f_{0,2}+f_{0,1}}{\left( \Delta S \right)^2}b^2_{0,2} = rf_{0,2} \\
\end{gathered}
\end{split}\]</div>
<p>This can be generalized for every node:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\frac{f_{i+1,j}-f_{i,j}}{\Delta t} + \frac{f_{i,j+1}-f_{i,j-1}}{2\Delta S}a_{i,j} + \frac{1}{2}\frac{f_{i,j+1}-2f_{i,j}+f_{i,j-1}}{\left( \Delta S \right)^2}b^2_{i,j} = rf_{i,j} \\
\end{split}\]</div>
<p>If we rearange the first equation such that we have unknowns on the left side and know values on the right side, we get:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{gathered}
f_{i,j-1}\left( -\frac{a_{i,j}}{2\Delta S} + \frac{b_{i,j}^2}{2(\Delta S)^2} \right) 
+ f_{i,j}\left(-\frac{1}{\Delta t} - \frac{b_{i,j}^2}{(\Delta S)^2} - r\right) 
+ f_{i,j+1}\left( \frac{a_{i,j}}{2\Delta S} + \frac{b_{i,j}^2}{2(\Delta S)^2}\right)
= -\frac{f_{i+1,j}}{\Delta t} \\
f_{i,j-1}\alpha_{i,j}
+ f_{i,j}\beta_{i,j}
+ f_{i,j+1}\gamma_{i,j}
= -\frac{f_{i+1,j}}{\Delta t}
\end{gathered}
\end{split}\]</div>
<p>where with <span class="math notranslate nohighlight">\(\alpha, \beta \text{ and } \gamma\)</span> we denote:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{split}
    \alpha_{i,j} &amp;=  -\frac{a_{i,j}}{2\Delta S} + \frac{b_{i,j}^2}{2(\Delta S)^2}  \\
    \beta_{i,j} &amp;= -\frac{1}{\Delta t} - \frac{b_{i,j}^2}{(\Delta S)^2} - r \\
    \gamma_{i,j} &amp;=  \frac{a_{i,j}}{2\Delta S} + \frac{b_{i,j}^2}{2(\Delta S)^2}
\end{split}
\end{split}\]</div>
</section>
<section id="equation-for-the-whole-row">
<h4>Equation for the whole row<a class="headerlink" href="#equation-for-the-whole-row" title="Link to this heading">#</a></h4>
<p>When it comes to the <strong>purple</strong> arrows, we have the following equation:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{gathered}
f_{0,0}\alpha_{0,1}
+ f_{0,1}\beta_{0,1}
+ f_{0,2}\gamma_{0,1}
= -\frac{f_{1,1}}{\Delta t} \\
\end{gathered}
\end{split}\]</div>
<p>And for the <strong>orange</strong> arrows:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{gathered}
f_{0,1}\alpha_{0,2}
+ f_{0,2}\beta_{0,2}
+ f_{0,3}\gamma_{0,2}
= -\frac{f_{1,2}}{\Delta t} \\
\end{gathered}
\end{split}\]</div>
<p>These two equations can be written in a matrix form:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{bmatrix}
    \alpha_{0,1} &amp; \beta_{0,1} &amp; \gamma_{0,1} &amp; 0 \\
    0 &amp; \alpha_{0,2} &amp; \beta_{0,2} &amp; \gamma_{0,2} \\
\end{bmatrix}
\begin{bmatrix}
    f_{0,0} \\ f_{0,1} \\ f_{0,2} \\ f_{0,3}
\end{bmatrix}
= 
\begin{bmatrix}
   -\frac{f_{1,1}}{\Delta t} \\ -\frac{f_{1,2}}{\Delta t}
\end{bmatrix}
\end{split}\]</div>
<p>This can of course be written to capture all nodes, and not just the first two nodes:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{bmatrix}
    \alpha_{0,1} &amp; \beta_{0,1} &amp; \gamma_{0,1} &amp; 0 &amp; 0 &amp; 0 &amp; \cdots &amp; 0 \\
    0 &amp; \alpha_{0,2} &amp; \beta_{0,2} &amp; \gamma_{0,2} &amp; 0 &amp; 0 &amp; \cdots &amp; 0 \\
    \vdots &amp; &amp; &amp; &amp; \vdots &amp; &amp; &amp; \vdots \\
    0 &amp; 0 &amp; \cdots &amp; &amp; 0 &amp; \alpha_{0,m-1} &amp; \beta_{0,m-1} &amp; \gamma_{0,m-1}
\end{bmatrix}
\begin{bmatrix}
    f_{0,0} \\ f_{0,1} \\ \vdots \\ f_{0,m}
\end{bmatrix}
= 
\begin{bmatrix}
   -\frac{f_{1,1}}{\Delta t} \\ -\frac{f_{1,2}}{\Delta t} \\ \vdots \\ -\frac{f_{1,m-1}}{\Delta t}
\end{bmatrix}
\end{split}\]</div>
<p>but the values <span class="math notranslate nohighlight">\(f_{0,0}\)</span> and <span class="math notranslate nohighlight">\(f_{0,m}\)</span> are known, because they are left and right boundary conditions for time <span class="math notranslate nohighlight">\(t=0\)</span>, so we need to get rid of these known values to get a square matrix on the left:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{bmatrix}
    \beta_{0,1} &amp; \gamma_{0,1} &amp; 0 &amp; 0 &amp; 0 &amp;\cdots &amp; 0\\
    \alpha_{0,2} &amp; \beta_{0,2} &amp; \gamma_{0,2} &amp; 0 &amp; 0 &amp; \cdots &amp; 0 \\
    0 &amp; \alpha_{0,3} &amp; \beta_{0,3} &amp; \gamma_{0,3} &amp; 0 &amp; \cdots &amp; 0 \\
    \vdots &amp; &amp; &amp; \ddots &amp; &amp; &amp; \vdots \\
    0 &amp; \cdots &amp; &amp; 0 &amp; \alpha_{0,m-2} &amp; \beta_{0,m-2} &amp; \gamma_{0,m-2} \\
    0 &amp; \cdots &amp; &amp; &amp; 0 &amp; \alpha_{0,m-1} &amp; \beta_{0,m-1} \\
\end{bmatrix}
\begin{bmatrix}
    f_{0,1} \\ f_{0,2} \\ f_{0,3} \\ \vdots \\ f_{0,m-2} \\ f_{0,m-1}
\end{bmatrix}
= 
\begin{bmatrix}
   -\frac{f_{1,1}}{\Delta t} - \alpha_{0,1}\cdot f_{0,0} \\ -\frac{f_{1,2}}{\Delta t} \\ -\frac{f_{1,3}}{\Delta t} \\ \vdots \\ -\frac{f_{1,m-2}}{\Delta t} \\ -\frac{f_{1,m-1}}{\Delta t} - \gamma_{0,m-1}f_{0,m}
\end{bmatrix}
\end{split}\]</div>
<p>Where <span class="math notranslate nohighlight">\(m=n_S=\frac{S_{max}}{\Delta S}\)</span> is the number of steps in the value of <span class="math notranslate nohighlight">\(S\)</span> in the grid. Essentially, what we did here was to remove the first and the last column from the matrix and moved the constant to the right side of their respective equations.</p>
<p>If we write down this equation compactly we get:</p>
<div class="math notranslate nohighlight">
\[M\cdot \underline{\vartheta} = \underline{d}\]</div>
<p>it means that we can obtain the solution for the whole row with:</p>
<div class="math notranslate nohighlight">
\[\underline{\vartheta} = M^{-1}\cdot\underline{d}\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Now we have shown how to obtain the solution for the whole row of the grid. We must repeat this action until we fill the whole grid. Notice that it is only important that the row below the one that we are trying to solve is solved (or is a boundary condition which is the case for the first step of the algorithm).</p>
</div>
<p>Let us now have a look at the implementation 😊</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nt</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">ns</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">ns</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

    <span class="c1"># fill the matrix M</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">ns</span><span class="p">):</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="o">-</span><span class="n">a</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span><span class="n">j</span><span class="o">*</span><span class="n">ds</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ds</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span><span class="n">j</span><span class="o">*</span><span class="n">ds</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ds</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">dt</span> <span class="o">-</span> <span class="p">(</span><span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span><span class="n">j</span><span class="o">*</span><span class="n">ds</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ds</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">a</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span><span class="n">j</span><span class="o">*</span><span class="n">ds</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ds</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span><span class="n">j</span><span class="o">*</span><span class="n">ds</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ds</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">coefs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">gamma</span><span class="p">])</span>
        <span class="n">M</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">coefs</span>
    
    <span class="c1"># Initialize vector d and move the constants on the right side of the equation</span>
    <span class="n">d</span> <span class="o">=</span> <span class="o">-</span><span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">dt</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">M</span><span class="p">)):</span>
        <span class="n">d</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="n">M</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">M</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="c1"># Remove the first and last column from the matrix</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">M</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="c1"># Solve the system and update the grid with the values we obtained</span>
    <span class="n">prices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>
    <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">prices</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="results">
<h2>Results<a class="headerlink" href="#results" title="Link to this heading">#</a></h2>
<p>Since we were working on a grid, and for each pair of <span class="math notranslate nohighlight">\((t_i, S_j)\)</span> we have determined the price <span class="math notranslate nohighlight">\(f_{i,j}\)</span> of our contract, we can represent the result as a 3-dimensional surface:</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">azim</span> <span class="o">=</span> <span class="mi">160</span>
<span class="n">ax</span><span class="o">.</span><span class="n">elev</span> <span class="o">=</span> <span class="mi">20</span>

<span class="n">t_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nt</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">dt</span>
<span class="n">s_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ns</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">ds</span>

<span class="n">t_axis</span><span class="p">,</span> <span class="n">s_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">t_axis</span><span class="p">,</span> <span class="n">s_axis</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">t_axis</span><span class="p">,</span> <span class="n">s_axis</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;plasma&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">S0</span><span class="p">,</span> <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">S0</span><span class="o">/</span><span class="n">ds</span><span class="p">)],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="n">S0</span><span class="p">,</span><span class="n">S0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">S0</span><span class="o">/</span><span class="n">ds</span><span class="p">)]],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time $t$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Spot price $S$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;Derivative price $F$&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/2041e1336dad3bc568d9499b376162ea23d2b914150d3dbf930084f14d10ed78.png" src="../_images/2041e1336dad3bc568d9499b376162ea23d2b914150d3dbf930084f14d10ed78.png" />
</div>
</div>
<p>In order to read the current price of the contract, i.e. the price for <span class="math notranslate nohighlight">\((t=0,S_0)\)</span> we need to read it by choosing the correct point on the grid:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Current price of the derivative is: </span><span class="si">{</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">S0</span><span class="o">/</span><span class="n">ds</span><span class="p">)]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Current price of the derivative is: 7.847763609439404
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The price obtained by using Black and Scholes formula for 4 call options was:</p>
<div class="math notranslate nohighlight">
\[P = 7.8535\]</div>
<p>which is very close to the price obtained by using the numerical method to solve the PDE.</p>
</div>
<p>Let us also have a look at the shape of the price for all times <span class="math notranslate nohighlight">\(t\)</span>, that is, what happens if we <em>cut</em> the surface above at each time <span class="math notranslate nohighlight">\(t\in[0,T=1]\)</span>. The color bar shows the <strong>white line</strong> corresponds to time <span class="math notranslate nohighlight">\(t=0\)</span>, while the <strong>dark blue line</strong> corresponds to time <span class="math notranslate nohighlight">\(t=T=1\)</span>. The lighter blue lines correspond to all times inbetween, where the level of <em>blueness</em> is determined by how close we are to the time of maturity <span class="math notranslate nohighlight">\(T\)</span>.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;Blues&#39;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>

<span class="n">steps</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">S_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">S_max</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">S_range</span><span class="p">,</span> <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="n">steps</span><span class="p">))</span>
    
<span class="c1"># Color bar setup</span>
<span class="n">normalize</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
<span class="n">scalarmappaple</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">normalize</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
<span class="n">scalarmappaple</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">steps</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scalarmappaple</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Cross section of the surface for all $t</span><span class="se">\\</span><span class="s1">in[0,T]$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/0a9e39c188664bf5ba4808153151c2cf380803ecbe47bdcad1f546cbcc782b62.png" src="../_images/0a9e39c188664bf5ba4808153151c2cf380803ecbe47bdcad1f546cbcc782b62.png" />
</div>
</div>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Link to this heading">#</a></h2>
<p>PDE are a very powerful way to price the derivative products. Not only it is fast, but it is also stable (the solution that we showed here). The downside of this method is that it is difficult to generalize for path-dependent derivatives and if a different method is used to populate the grid the solution may become unstable.</p>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Personal Notes</p></li>
<li><p>Bocconi Lectures on Computational Methods in Finance</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./stochastic_processes"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="ou_mean_reverting_bond_price.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Bond prices under the Ornstein Uhlenbeck mean-reverting process</p>
      </div>
    </a>
    <a class="right-next"
       href="../fixed_income/yc_and_ts.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Yield Curve, Zero Rates, and Term Structure</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-generic-price-process-s-t">A generic price process <span class="math notranslate nohighlight">\(S_t\)</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#black-scholes-pde">Black Scholes PDE</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#proof">Proof</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#choosing-the-payoff-to-price">Choosing the payoff to price</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#constructing-the-grid">Constructing the grid</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#choosing-the-process-governing-the-underlying-s">Choosing the process governing the underlying <span class="math notranslate nohighlight">\(S\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#partial-derivatives-estimation">Partial derivatives estimation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#constructing-the-system-of-equations">Constructing the system of equations</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#single-node-equation">Single node equation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#equation-for-the-whole-row">Equation for the whole row</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#results">Results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>